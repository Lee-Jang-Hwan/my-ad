# Supabase Storage ì„¤ì • ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

Supabase Storage ë²„í‚·ì€ SQLë¡œ ì§ì ‘ ìƒì„±í•  ìˆ˜ ì—†ìœ¼ë©°, **Dashboard UIë¥¼ í†µí•´ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±**í•´ì•¼ í•©ë‹ˆë‹¤.
ì´ ê°€ì´ë“œëŠ” 2ë‹¨ê³„ í”„ë¡œì„¸ìŠ¤ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤:

1. **Dashboardì—ì„œ ë²„í‚· ìƒì„±** (ìˆ˜ë™)
2. **SQLë¡œ ì •ì±… ë° í—¬í¼ í•¨ìˆ˜ ì„¤ì •** (ìë™)

---

## ğŸ”§ 1ë‹¨ê³„: Dashboardì—ì„œ ë²„í‚· ìƒì„±

### ì ‘ì† ë°©ë²•
1. [Supabase Dashboard](https://supabase.com/dashboard) ì ‘ì†
2. í”„ë¡œì íŠ¸ ì„ íƒ
3. ì¢Œì¸¡ ë©”ë‰´ì—ì„œ **Storage** í´ë¦­
4. **"New bucket"** ë²„íŠ¼ í´ë¦­

### Bucket 1: uploads (ì´ë¯¸ì§€ ì—…ë¡œë“œ)

ë‹¤ìŒ ì„¤ì •ìœ¼ë¡œ ì²« ë²ˆì§¸ ë²„í‚·ì„ ìƒì„±í•˜ì„¸ìš”:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bucket 1: uploads                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Name: uploads                                   â”‚
â”‚ Public bucket: âœ“ (ì²´í¬)                         â”‚
â”‚ File size limit: 10485760 (10MB)                â”‚
â”‚ Allowed MIME types:                             â”‚
â”‚   - image/jpeg                                  â”‚
â”‚   - image/png                                   â”‚
â”‚   - image/jpg                                   â”‚
â”‚   - image/webp                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì„¤ëª…:**
- ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ ì›ë³¸ ì œí’ˆ ì´ë¯¸ì§€ë¥¼ ì €ì¥
- ê²½ë¡œ êµ¬ì¡°: `{clerk_user_id}/images/{filename}`
- ì˜ˆì‹œ: `user_test001/images/coffee-latte-001.jpg`

### Bucket 2: videos (ìµœì¢… ì˜ìƒ)

ë‹¤ìŒ ì„¤ì •ìœ¼ë¡œ ë‘ ë²ˆì§¸ ë²„í‚·ì„ ìƒì„±í•˜ì„¸ìš”:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Bucket 2: videos                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Name: videos                                    â”‚
â”‚ Public bucket: âœ“ (ì²´í¬)                         â”‚
â”‚ File size limit: 52428800 (50MB)                â”‚
â”‚ Allowed MIME types:                             â”‚
â”‚   - video/mp4                                   â”‚
â”‚   - video/webm                                  â”‚
â”‚   - video/quicktime                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì„¤ëª…:**
- n8n ì›Œí¬í”Œë¡œìš°ê°€ ìƒì„±í•œ ìµœì¢… í™ë³´ì˜ìƒì„ ì €ì¥
- ê²½ë¡œ êµ¬ì¡°: `{clerk_user_id}/videos/{video_id}.mp4`
- ì˜ˆì‹œ: `user_test001/videos/a1b2c3d4-e5f6-7890-abcd-ef1234567890.mp4`

---

## ğŸš€ 2ë‹¨ê³„: SQLë¡œ ì •ì±… ì„¤ì •

ë²„í‚·ì„ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•œ í›„, ë‹¤ìŒ SQL íŒŒì¼ì„ ì‹¤í–‰í•˜ì„¸ìš”:

### ì‹¤í–‰ ë°©ë²•

1. Supabase Dashboard â†’ **SQL Editor** ë©”ë‰´
2. **"New query"** ë²„íŠ¼ í´ë¦­
3. `supabase/migrations/my_ad_storage.sql` íŒŒì¼ ë‚´ìš© ë³µì‚¬
4. SQL Editorì— ë¶™ì—¬ë„£ê¸°
5. **"Run"** ë²„íŠ¼ í´ë¦­

### SQLì´ ì„¤ì •í•˜ëŠ” í•­ëª©

âœ… **RLS ì •ì±…**
- `uploads` ë²„í‚·: ëª¨ë“  ì‘ì—… í—ˆìš© (ê°œë°œ ëª¨ë“œ)
- `videos` ë²„í‚·: ëª¨ë“  ì‘ì—… í—ˆìš© (ê°œë°œ ëª¨ë“œ)

âœ… **í—¬í¼ í•¨ìˆ˜**
- `generate_upload_path(user_id, filename)` - ì´ë¯¸ì§€ ê²½ë¡œ ìƒì„±
- `generate_video_path(user_id, video_id)` - ì˜ìƒ ê²½ë¡œ ìƒì„±
- `generate_thumbnail_path(user_id, video_id)` - ì¸ë„¤ì¼ ê²½ë¡œ ìƒì„±
- `get_user_storage_usage(user_id)` - ì‚¬ìš©ìë³„ ìš©ëŸ‰ í™•ì¸

âœ… **ë·°**
- `storage_bucket_info` - ë²„í‚· ì •ë³´ ìš”ì•½ (íŒŒì¼ ê°œìˆ˜, ì´ ìš©ëŸ‰ ë“±)

âœ… **ìƒ˜í”Œ ë°ì´í„°**
- ê°œë°œìš© ë”ë¯¸ íŒŒì¼ ê²½ë¡œ (ì‹¤ì œ íŒŒì¼ì€ ì—†ìŒ)

---

## âœ… ê²€ì¦ ë°©ë²•

SQL ì‹¤í–‰ í›„, ë‹¤ìŒ ì¿¼ë¦¬ë¡œ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”:

```sql
-- ë²„í‚· ì •ë³´ í™•ì¸
SELECT * FROM storage_bucket_info;

-- ì‚¬ìš©ìë³„ ìš©ëŸ‰ í™•ì¸ (user_test001 ì˜ˆì‹œ)
SELECT * FROM get_user_storage_usage('user_test001');

-- í—¬í¼ í•¨ìˆ˜ í…ŒìŠ¤íŠ¸
SELECT generate_upload_path('user_test001', 'test.jpg');
SELECT generate_video_path('user_test001', gen_random_uuid());
```

---

## ğŸ” ë¬¸ì œ í•´ê²°

### ì˜¤ë¥˜: "must be owner of relation buckets"
- **ì›ì¸**: SQLë¡œ ë²„í‚·ì„ ìƒì„±í•˜ë ¤ê³  ì‹œë„
- **í•´ê²°**: Dashboard UIì—ì„œ ë²„í‚·ì„ ë¨¼ì € ìƒì„±í•˜ê³ , SQLì€ ì •ì±… ì„¤ì •ë§Œ ì‹¤í–‰

### ì˜¤ë¥˜: "uploads ë²„í‚·ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
- **ì›ì¸**: 1ë‹¨ê³„(ë²„í‚· ìƒì„±)ë¥¼ ê±´ë„ˆëœ€
- **í•´ê²°**: Dashboardì—ì„œ `uploads` ë²„í‚·ì„ ìƒì„±

### ì˜¤ë¥˜: "videos ë²„í‚·ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤"
- **ì›ì¸**: 1ë‹¨ê³„(ë²„í‚· ìƒì„±)ë¥¼ ê±´ë„ˆëœ€
- **í•´ê²°**: Dashboardì—ì„œ `videos` ë²„í‚·ì„ ìƒì„±

---

## ğŸ“š ë‹¤ìŒ ë‹¨ê³„

Storage ì„¤ì •ì´ ì™„ë£Œë˜ë©´:

1. âœ… Phase 1 ì™„ë£Œ í™•ì¸
   - Database ìŠ¤í‚¤ë§ˆ: `supabase/migrations/my_ad_schema.sql`
   - Storage ì„¤ì •: `supabase/migrations/my_ad_storage.sql`

2. ğŸš€ Phase 2 ì‹œì‘: ì—…ë¡œë“œ í˜ì´ì§€ UI ê°œë°œ
   - Next.js í˜ì´ì§€ êµ¬í˜„
   - Supabase Storage ì—…ë¡œë“œ ê¸°ëŠ¥
   - ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
   - n8n ì›¹í›… íŠ¸ë¦¬ê±°

---

## ğŸ“– ì°¸ê³  ìë£Œ

- [Supabase Storage ê³µì‹ ë¬¸ì„œ](https://supabase.com/docs/guides/storage)
- [PRD ë¬¸ì„œ](../docs/PRD.md)
- [Database ìŠ¤í‚¤ë§ˆ](./migrations/my_ad_schema.sql)
