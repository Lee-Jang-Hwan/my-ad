-- =====================================================
-- ğŸš¨ ì¦‰ì‹œ ìˆ˜ì •: ê¸°ì¡´ ì˜ìƒ URL ì—…ë°ì´íŠ¸
-- =====================================================
--
-- ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” n8n í‘œí˜„ì‹ìœ¼ë¡œ ì˜ëª» ì €ì¥ëœ video_urlì„
-- ì‹¤ì œ Supabase Storage URLë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤.
--
-- âš ï¸ ì£¼ì˜: ì‹¤í–‰í•˜ê¸° ì „ì— ë°˜ë“œì‹œ ì•„ë˜ ë‹¨ê³„ë¥¼ ì™„ë£Œí•˜ì„¸ìš”!
-- =====================================================

-- =====================================================
-- Step 1: í˜„ì¬ ìƒíƒœ í™•ì¸
-- =====================================================
-- ì˜ëª» ì €ì¥ëœ ë ˆì½”ë“œ í™•ì¸
SELECT
    id,
    status,
    video_url,
    thumbnail_url,
    duration,
    file_size,
    created_at,
    completed_at
FROM ad_videos
WHERE id = 'd549de22-57c1-4d9a-acbf-00496e7f26c1';

-- ê²°ê³¼ ì˜ˆì‹œ:
-- id: d549de22-57c1-4d9a-acbf-00496e7f26c1
-- video_url: ={{ $('ì‘ë‹µ ì²˜ë¦¬').item.json.publicUrl }}  âŒ ì˜ëª»ë¨!
-- thumbnail_url: null
-- duration: null
-- file_size: null


-- =====================================================
-- Step 2: Supabase Storageì—ì„œ ì‹¤ì œ ì˜ìƒ URL ì°¾ê¸°
-- =====================================================
--
-- ğŸ” ë‹¤ìŒ ë‹¨ê³„ë¥¼ ë”°ë¼ ì‹¤ì œ URLì„ ì°¾ìœ¼ì„¸ìš”:
--
-- 1. Supabase ëŒ€ì‹œë³´ë“œ ì—´ê¸°: https://supabase.com/dashboard
-- 2. í”„ë¡œì íŠ¸ ì„ íƒ
-- 3. ì™¼ìª½ ë©”ë‰´ì—ì„œ "Storage" í´ë¦­
-- 4. "videos" ë²„í‚· í´ë¦­ (ë˜ëŠ” ì˜ìƒì´ ì €ì¥ëœ ë²„í‚·)
-- 5. ì‚¬ìš©ì í´ë” ì—´ê¸°: user_354SZeUdpOzWRwxkN7bN5QfdXF6/
-- 6. ì˜ìƒ íŒŒì¼ ì°¾ê¸° (ìµœê·¼ ë‚ ì§œì˜ .mp4 íŒŒì¼)
-- 7. íŒŒì¼ ìš°í´ë¦­ â†’ "Copy URL" ë˜ëŠ” "Get public URL"
-- 8. URL ë³µì‚¬ (í˜•ì‹: https://PROJECT-ID.supabase.co/storage/v1/object/public/videos/user_xxx/video_xxx.mp4)
--
-- ë³µì‚¬í•œ URLì„ ì•„ë˜ UPDATE ì¿¼ë¦¬ì— ë¶™ì—¬ë„£ìœ¼ì„¸ìš”!


-- =====================================================
-- Step 3: video_url ì—…ë°ì´íŠ¸ (ì‹¤ì œ URLë¡œ êµì²´ í•„ìˆ˜!)
-- =====================================================

-- âš ï¸ ì£¼ì˜: ì•„ë˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ê¸° ì „ì—
-- 'YOUR_ACTUAL_VIDEO_URL_HERE'ë¥¼
-- Step 2ì—ì„œ ë³µì‚¬í•œ ì‹¤ì œ URLë¡œ êµì²´í•˜ì„¸ìš”!

UPDATE ad_videos
SET
    -- âœ… ì‹¤ì œ Supabase Storage URLë¡œ êµì²´í•˜ì„¸ìš”!
    video_url = 'YOUR_ACTUAL_VIDEO_URL_HERE',

    -- thumbnail_urlì€ NULLë¡œ ìœ ì§€ (n8nì—ì„œ ì¸ë„¤ì¼ ìƒì„± ì•ˆí•¨)
    thumbnail_url = NULL,

    -- ì˜ìƒ ì •ë³´ (ì‹¤ì œ ê°’ìœ¼ë¡œ ìˆ˜ì • ê°€ëŠ¥)
    duration = 8,           -- ì˜ìƒ ê¸¸ì´ (ì´ˆ). n8n ë¡œê·¸ì—ì„œ í™•ì¸ ê°€ëŠ¥
    file_size = 15000000,   -- íŒŒì¼ í¬ê¸° (bytes). n8n ë¡œê·¸ì—ì„œ í™•ì¸ ê°€ëŠ¥

    -- ì™„ë£Œ ì‹œê°„ í˜„ì¬ ì‹œê°ìœ¼ë¡œ ì„¤ì •
    completed_at = NOW()

WHERE id = 'd549de22-57c1-4d9a-acbf-00496e7f26c1';

-- âœ… ì˜ˆì‹œ (ì‹¤ì œ URLë¡œ êµì²´):
-- UPDATE ad_videos
-- SET
--     video_url = 'https://abcdefghijk.supabase.co/storage/v1/object/public/videos/user_354SZeUdpOzWRwxkN7bN5QfdXF6/20251116_video_001.mp4',
--     thumbnail_url = NULL,
--     duration = 10,
--     file_size = 18500000,
--     completed_at = NOW()
-- WHERE id = 'd549de22-57c1-4d9a-acbf-00496e7f26c1';


-- =====================================================
-- Step 4: ìˆ˜ì • ê²°ê³¼ í™•ì¸
-- =====================================================

-- ì—…ë°ì´íŠ¸ í›„ í™•ì¸
SELECT
    id,
    status,
    video_url,
    thumbnail_url,
    duration,
    file_size,
    completed_at
FROM ad_videos
WHERE id = 'd549de22-57c1-4d9a-acbf-00496e7f26c1';

-- âœ… ê¸°ëŒ€ ê²°ê³¼:
-- video_url: https://...supabase.co/storage/v1/object/public/videos/...  (ì‹¤ì œ URL)
-- thumbnail_url: null
-- duration: 8 (ë˜ëŠ” ì‹¤ì œ ê°’)
-- file_size: 15000000 (ë˜ëŠ” ì‹¤ì œ ê°’)
-- completed_at: 2025-01-17 ... (í˜„ì¬ ì‹œê°)


-- =====================================================
-- Step 5: ì›¹ í˜ì´ì§€ í…ŒìŠ¤íŠ¸
-- =====================================================
--
-- SQL ì‹¤í–‰ í›„:
-- 1. ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:3000/dashboard ìƒˆë¡œê³ ì¹¨
-- 2. ì˜ìƒ ì¹´ë“œì— ì¸ë„¤ì¼ (ë˜ëŠ” ì˜ìƒ ì²« í”„ë ˆì„) í‘œì‹œ í™•ì¸
-- 3. "ì˜ìƒ ë³´ê¸°" ë²„íŠ¼ í´ë¦­
-- 4. ì˜ìƒ ì¬ìƒ í™•ì¸ âœ…
-- 5. "ì˜ìƒ ë‹¤ìš´ë¡œë“œ" ë²„íŠ¼ í´ë¦­
-- 6. ë‹¤ìš´ë¡œë“œ ì‹œì‘ í™•ì¸ âœ…
--
-- ğŸ‰ ëª¨ë‘ ì„±ê³µí•˜ë©´ ê¸°ì¡´ ì˜ìƒì€ ìˆ˜ì • ì™„ë£Œ!


-- =====================================================
-- (ì„ íƒì‚¬í•­) n8n ë¡œê·¸ì—ì„œ durationê³¼ file_size ì°¾ê¸°
-- =====================================================
--
-- durationê³¼ file_sizeì˜ ì •í™•í•œ ê°’ì„ ì•Œê³  ì‹¶ë‹¤ë©´:
--
-- 1. n8n ì›Œí¬í”Œë¡œìš° ì—´ê¸°
-- 2. ìƒë‹¨ "Executions" íƒ­ í´ë¦­
-- 3. ê°€ì¥ ìµœê·¼ ì„±ê³µí•œ ì‹¤í–‰ í´ë¦­
-- 4. "ì‘ë‹µ ì²˜ë¦¬" ë…¸ë“œ í´ë¦­
-- 5. "Output" íƒ­ì—ì„œ í™•ì¸:
--    {
--      "publicUrl": "https://...",
--      "duration": 8,        â† ì´ ê°’ì„ ì‚¬ìš©
--      "fileSize": 15000000  â† ì´ ê°’ì„ ì‚¬ìš©
--    }
-- 6. ìœ„ UPDATE ì¿¼ë¦¬ì˜ durationê³¼ file_sizeë¥¼ ì‹¤ì œ ê°’ìœ¼ë¡œ ìˆ˜ì •


-- =====================================================
-- âš ï¸ ì¤‘ìš”: í–¥í›„ ì˜ìƒì„ ìœ„í•œ n8n ì›Œí¬í”Œë¡œìš° ìˆ˜ì • í•„ìˆ˜!
-- =====================================================
--
-- ì´ SQLì€ ê¸°ì¡´ ì˜ìƒ 1ê°œë§Œ ìˆ˜ì •í•©ë‹ˆë‹¤.
--
-- ì•ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ëª¨ë“  ì˜ìƒì´ ì •ìƒ ì‘ë™í•˜ë ¤ë©´
-- n8n ì›Œí¬í”Œë¡œìš°ë¥¼ ë°˜ë“œì‹œ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤!
--
-- ğŸ“– ìì„¸í•œ ë°©ë²•:
-- - docs/N8N_VIDEO_URL_FIX.md
-- - docs/URGENT_FIX_GUIDE.md
-- - docs/IMMEDIATE_FIX_STEPS.md
--
-- í•µì‹¬ ìˆ˜ì • ì‚¬í•­:
-- 1. n8n "ìµœì¢… ì—…ë°ì´íŠ¸: Completed" ë…¸ë“œ ì—´ê¸°
-- 2. video_url í•„ë“œì˜ Expression í† ê¸€ ON
-- 3. thumbnail_url í•„ë“œì˜ Expression í† ê¸€ ON
-- 4. duration í•„ë“œì˜ Expression í† ê¸€ ON
-- 5. file_size í•„ë“œì˜ Expression í† ê¸€ ON
-- 6. completed_at í•„ë“œì˜ Expression í† ê¸€ ON
-- 7. ì›Œí¬í”Œë¡œìš° ì €ì¥
-- 8. ìƒˆ ì˜ìƒ ìƒì„± í…ŒìŠ¤íŠ¸
--
-- =====================================================