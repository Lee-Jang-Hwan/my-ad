# ì˜ìƒ ë§Œë“¤ê¸° ê³ ë„í™” ìˆ˜ì • ê³„íšì„œ

**ì‘ì„±ì¼**: 2025-11-29
**ë²„ì „**: 1.0.0
**ì‘ì„±ì**: Claude Code

---

## 1. ê°œìš”

### 1.1 í˜„ì¬ íë¦„ (AS-IS)
```
ì‚¬ìš©ì ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ ìƒí’ˆëª… ì…ë ¥ â†’ ì˜ìƒ ìƒì„± ì‹œì‘ í´ë¦­
    â†“
n8n ì›Œí¬í”Œë¡œìš° í˜¸ì¶œ (ëœë¤ í”„ë¡¬í”„íŠ¸ë¡œ ìë™ ì§„í–‰)
    â†“
ê´‘ê³ ë¬¸êµ¬ ìƒì„± â†’ ì´ë¯¸ì§€ ì •ì œ â†’ ì˜ìƒ ìƒì„± â†’ ì™„ë£Œ
```

### 1.2 ë³€ê²½ íë¦„ (TO-BE)
```
ì‚¬ìš©ì ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ ìƒí’ˆëª… ì…ë ¥ â†’ [ê´‘ê³ ë¬¸êµ¬ ìƒì„±] ë²„íŠ¼ í´ë¦­
    â†“
sapp-studio-adcopy webhook í˜¸ì¶œ
    â†“
ê´‘ê³  ë¬¸êµ¬ 5ê°œ ìƒì„± â†’ ì›¹ì—ì„œ ì¹´ë“œ í˜•íƒœë¡œ í‘œì‹œ
    â†“
ì‚¬ìš©ìê°€ 5ê°œ ì¤‘ 1ê°œ ì„ íƒ (ë˜ëŠ” "ë‹¤ì‹œ ìƒì„±" í´ë¦­)
    â†“
ì„ íƒëœ ê´‘ê³ ë¬¸êµ¬ì™€ í•¨ê»˜ sapp-studio-advideo webhook í˜¸ì¶œ
    â†“
ì´ë¯¸ì§€ ì •ì œ â†’ ì˜ìƒ ìƒì„± â†’ ì™„ë£Œ (ê¸°ì¡´ê³¼ ë™ì¼)
```

---

## 2. n8n ì›Œí¬í”Œë¡œìš° ë¶„ì„

### 2.1 sapp-studio-adcopy (ê´‘ê³ ë¬¸êµ¬ ìƒì„±)
- **Webhook URL**: `https://n8n.sappstudio.kr/webhook/84e18e95-00b9-4963-9a6f-c14225a84d15`
- **ì¸ì¦**: Basic Auth (ssap)
- **ìš”ì²­ Body**:
  ```json
  {
    "ad_video_id": "uuid",
    "product_image_id": "uuid",
    "product_info_id": "uuid"
  }
  ```
- **ì‘ë‹µ í˜•ì‹**:
  ```json
  {
    "success": true,
    "message": "ê´‘ê³  ë¬¸êµ¬ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.",
    "ad_video_id": "uuid",
    "product_name": "ìƒí’ˆëª…",
    "ad_copies": [
      { "id": 1, "text": "ê´‘ê³ ë¬¸êµ¬ 1" },
      { "id": 2, "text": "ê´‘ê³ ë¬¸êµ¬ 2" },
      { "id": 3, "text": "ê´‘ê³ ë¬¸êµ¬ 3" },
      { "id": 4, "text": "ê´‘ê³ ë¬¸êµ¬ 4" },
      { "id": 5, "text": "ê´‘ê³ ë¬¸êµ¬ 5" }
    ],
    "generated_at": "2025-11-29T00:00:00.000Z"
  }
  ```
- **íŠ¹ì§•**: Gemini 2.5 Proë¡œ Bê¸‰ í‚¤ì¹˜ ë§ˆì¼€íŒ… ìŠ¤íƒ€ì¼ ê´‘ê³ ë¬¸êµ¬ 5ê°œ ìƒì„±

### 2.2 sapp-studio-advideo (ì˜ìƒ ìƒì„±)
- **Webhook URL**: `https://n8n.sappstudio.kr/webhook/70980457-f61e-42f1-84c3-5245f1438435`
- **ì¸ì¦**: Basic Auth (ssap)
- **ìš”ì²­ Body**:
  ```json
  {
    "ad_video_id": "uuid",
    "product_image_id": "uuid",
    "product_info_id": "uuid",
    "selected_ad_copy": "ì‚¬ìš©ìê°€ ì„ íƒí•œ ê´‘ê³ ë¬¸êµ¬ í…ìŠ¤íŠ¸"
  }
  ```
- **ì²˜ë¦¬ ë‹¨ê³„**:
  1. `ad_copy_generation` â†’ ì´ë¯¸ì§€/ì˜ìƒ í”„ë¡¬í”„íŠ¸ ìƒì„±
  2. `image_refinement` â†’ Geminië¡œ ì´ë¯¸ì§€ ì •ì œ
  3. `video_generation` â†’ Sora 2 Proë¡œ ì˜ìƒ ìƒì„±
  4. `completed` â†’ Supabaseì— ì˜ìƒ ì—…ë¡œë“œ

---

## 3. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë³€ê²½

### 3.1 ì‹ ê·œ í…Œì´ë¸”: `ad_copies` (ê´‘ê³ ë¬¸êµ¬ ì €ì¥)
```sql
CREATE TABLE ad_copies (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  ad_video_id UUID NOT NULL REFERENCES ad_videos(id) ON DELETE CASCADE,
  copy_index INTEGER NOT NULL CHECK (copy_index >= 1 AND copy_index <= 5),
  copy_text TEXT NOT NULL,
  is_selected BOOLEAN DEFAULT FALSE,
  created_at TIMESTAMPTZ DEFAULT NOW(),

  UNIQUE(ad_video_id, copy_index)
);

CREATE INDEX idx_ad_copies_ad_video_id ON ad_copies(ad_video_id);
CREATE INDEX idx_ad_copies_selected ON ad_copies(ad_video_id) WHERE is_selected = TRUE;

COMMENT ON TABLE ad_copies IS 'ê´‘ê³ ë¬¸êµ¬ 5ê°œ ì €ì¥ ë° ì„ íƒ ìƒíƒœ ê´€ë¦¬';
```

### 3.2 ad_videos í…Œì´ë¸” ìˆ˜ì •
- **progress_stage ê°’ ì¶”ê°€**: `ad_copy_selection` (ê´‘ê³ ë¬¸êµ¬ ì„ íƒ ëŒ€ê¸° ìƒíƒœ)
- **selected_ad_copy ì¹¼ëŸ¼ ì¶”ê°€**: ìµœì¢… ì„ íƒëœ ê´‘ê³ ë¬¸êµ¬ í…ìŠ¤íŠ¸ ì €ì¥

```sql
-- progress_stage CHECK ì œì•½ì¡°ê±´ ìˆ˜ì •
ALTER TABLE ad_videos
DROP CONSTRAINT IF EXISTS ad_videos_progress_stage_check;

ALTER TABLE ad_videos
ADD CONSTRAINT ad_videos_progress_stage_check
CHECK (progress_stage = ANY (ARRAY[
  'init'::text,
  'ad_copy_generation'::text,
  'ad_copy_selection'::text,  -- ì‹ ê·œ ì¶”ê°€
  'image_refinement'::text,
  'video_generation'::text,
  'tts_generation'::text,
  'subtitle_generation'::text,
  'merging'::text,
  'completed'::text,
  'failed'::text,
  'cancelled'::text
]));

-- ì„ íƒëœ ê´‘ê³ ë¬¸êµ¬ ì €ì¥ ì¹¼ëŸ¼ ì¶”ê°€
ALTER TABLE ad_videos
ADD COLUMN selected_ad_copy TEXT;

COMMENT ON COLUMN ad_videos.selected_ad_copy IS 'ì‚¬ìš©ìê°€ ì„ íƒí•œ ìµœì¢… ê´‘ê³ ë¬¸êµ¬';
```

---

## 4. íŒŒì¼ë³„ ìˆ˜ì • ê³„íš

### 4.1 ì‹ ê·œ íŒŒì¼ ìƒì„±

#### íƒ€ì… ì •ì˜
| íŒŒì¼ ê²½ë¡œ | ì„¤ëª… |
|-----------|------|
| `types/ad-copy.ts` | ê´‘ê³ ë¬¸êµ¬ ê´€ë ¨ íƒ€ì… ì •ì˜ |

#### Server Actions
| íŒŒì¼ ê²½ë¡œ | ì„¤ëª… |
|-----------|------|
| `actions/generate-ad-copies.ts` | adcopy webhook í˜¸ì¶œ ë° ê´‘ê³ ë¬¸êµ¬ ìƒì„± |
| `actions/select-ad-copy.ts` | ê´‘ê³ ë¬¸êµ¬ ì„ íƒ ë° ì˜ìƒìƒì„± ì§„í–‰ |
| `actions/fetch-ad-copies.ts` | ì €ì¥ëœ ê´‘ê³ ë¬¸êµ¬ ì¡°íšŒ |

#### UI ì»´í¬ë„ŒíŠ¸
| íŒŒì¼ ê²½ë¡œ | ì„¤ëª… |
|-----------|------|
| `components/upload/ad-copy-selection.tsx` | ê´‘ê³ ë¬¸êµ¬ ì„ íƒ ë©”ì¸ ì»´í¬ë„ŒíŠ¸ |
| `components/upload/ad-copy-card.tsx` | ê°œë³„ ê´‘ê³ ë¬¸êµ¬ ì¹´ë“œ |
| `components/upload/ad-copy-skeleton.tsx` | ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤ |

### 4.2 ê¸°ì¡´ íŒŒì¼ ìˆ˜ì •

| íŒŒì¼ ê²½ë¡œ | ìˆ˜ì • ë‚´ìš© |
|-----------|----------|
| `components/upload/upload-form.tsx` | 3ë‹¨ê³„ â†’ 4ë‹¨ê³„ ì›Œí¬í”Œë¡œìš°ë¡œ ë³€ê²½ |
| `actions/trigger-n8n.ts` | advideo webhookì— selected_ad_copy í¬í•¨ |
| `constants/generation.ts` | `ad_copy_selection` ë‹¨ê³„ ì¶”ê°€ |
| `types/generation.ts` | GenerationStageì— `ad_copy_selection` ì¶”ê°€ |
| `lib/generation-utils.ts` | ì§„í–‰ë¥  ê³„ì‚° ë¡œì§ ì—…ë°ì´íŠ¸ |
| `components/generation/step-indicator.tsx` | 6ë‹¨ê³„ë¡œ UI ìˆ˜ì • |

---

## 5. UI/UX ì„¤ê³„

### 5.1 ì—…ë¡œë“œ í˜ì´ì§€ 4ë‹¨ê³„ ì›Œí¬í”Œë¡œìš°

```
[Step 1] ì´ë¯¸ì§€ ì—…ë¡œë“œ
    â†“
[Step 2] ìƒí’ˆëª… ì…ë ¥
    â†“
[Step 3] ê´‘ê³ ë¬¸êµ¬ ìƒì„± & ì„ íƒ  â† ì‹ ê·œ ë‹¨ê³„
    â†“
[Step 4] ì˜ìƒ ìƒì„± ì§„í–‰
```

### 5.2 ê´‘ê³ ë¬¸êµ¬ ì„ íƒ UI êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ ê´‘ê³ ë¬¸êµ¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“ ê´‘ê³ ë¬¸êµ¬ 1        â”‚  â”‚ ğŸ“ ê´‘ê³ ë¬¸êµ¬ 2        â”‚  â”‚
â”‚  â”‚                     â”‚  â”‚                     â”‚  â”‚
â”‚  â”‚ "ê°œë¯¸ëŠ” ëš ëš  ì˜¤ëŠ˜ë„  â”‚  â”‚ "ë‹¤ì´ì–´íŠ¸ ë‚´ì¼ë¶€í„°   â”‚  â”‚
â”‚  â”‚  ëš ëš  ë–¡ë³¶ì´ë¥¼ ë¨¹ë„¤" â”‚  â”‚  í•  ê±°ì§€? ê·¸ëŸ´ ì¤„    â”‚  â”‚
â”‚  â”‚                     â”‚  â”‚  ì•Œì•˜ì–´"              â”‚  â”‚
â”‚  â”‚     [ì„ íƒí•˜ê¸°]       â”‚  â”‚     [ì„ íƒí•˜ê¸°]       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“ ê´‘ê³ ë¬¸êµ¬ 3        â”‚  â”‚ ğŸ“ ê´‘ê³ ë¬¸êµ¬ 4        â”‚  â”‚
â”‚  â”‚ ...                 â”‚  â”‚ ...                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ“ ê´‘ê³ ë¬¸êµ¬ 5                                â”‚   â”‚
â”‚  â”‚ ...                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  ğŸ”„ ë‹¤ì‹œ ìƒì„±     â”‚  â”‚  âœ… ì„ íƒ ì™„ë£Œ & ì§„í–‰   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 ê´‘ê³ ë¬¸êµ¬ ì¹´ë“œ ìƒì„¸ ë””ìì¸

ê° ì¹´ë“œì— í‘œì‹œí•  ë‚´ìš©:
- **ì¹´ë“œ ë²ˆí˜¸** (1~5)
- **ê´‘ê³ ë¬¸êµ¬ í…ìŠ¤íŠ¸** (ë©”ì¸ ì½˜í…ì¸ )
- **ì„ íƒ ë²„íŠ¼** (í´ë¦­ ì‹œ í•˜ì´ë¼ì´íŠ¸)
- **ì„ íƒëœ ìƒíƒœ í‘œì‹œ** (ì²´í¬ë§ˆí¬, í…Œë‘ë¦¬ ê°•ì¡°)

### 5.4 ì¶”ê°€ í‘œì‹œ ê¶Œì¥ ì •ë³´

1. **ìƒí’ˆ ì •ë³´ ìš”ì•½**
   - ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ ì¸ë„¤ì¼
   - ì…ë ¥í•œ ìƒí’ˆëª…

2. **ê´‘ê³ ë¬¸êµ¬ ìŠ¤íƒ€ì¼ ê°€ì´ë“œ**
   - "Bê¸‰ í‚¤ì¹˜ ë§ˆì¼€íŒ… ìŠ¤íƒ€ì¼ë¡œ ìƒì„±ëœ ë¬¸êµ¬ì…ë‹ˆë‹¤"
   - ê° ë¬¸êµ¬ì˜ ìŠ¤íƒ€ì¼ íƒœê·¸ (ì–¸ì–´ìœ í¬, íŒ©íŠ¸í­ë ¥, ë©”íƒ€ë°œì–¸, ê³¼ì¥, ì•„ë¬´ë§ ë“±)

3. **ìƒì„± ìƒíƒœ í‘œì‹œ**
   - ë¡œë”© ì¤‘: "AIê°€ ê´‘ê³ ë¬¸êµ¬ë¥¼ ìƒì„±í•˜ê³  ìˆì–´ìš”..."
   - ì™„ë£Œ: "5ê°œì˜ ê´‘ê³ ë¬¸êµ¬ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!"
   - ì‹¤íŒ¨: "ë¬¸êµ¬ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”."

4. **ì„ íƒ í›„ í™•ì¸**
   - ì„ íƒëœ ë¬¸êµ¬ ë¯¸ë¦¬ë³´ê¸°
   - "ì´ ë¬¸êµ¬ë¡œ ì˜ìƒì„ ìƒì„±í• ê¹Œìš”?" í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸

---

## 6. ì§„í–‰ ë‹¨ê³„ ì—…ë°ì´íŠ¸

### 6.1 ê¸°ì¡´ ë‹¨ê³„ (5ë‹¨ê³„)
```
init â†’ ad_copy_generation â†’ image_refinement â†’ video_generation â†’ completed
```

### 6.2 ë³€ê²½ ë‹¨ê³„ (6ë‹¨ê³„)
```
init â†’ ad_copy_generation â†’ ad_copy_selection â†’ image_refinement â†’ video_generation â†’ completed
```

### 6.3 ë‹¨ê³„ë³„ ì„¤ëª…

| ë‹¨ê³„ | í•œê¸€ ë ˆì´ë¸” | ì„¤ëª… | ì˜ˆìƒ ì‹œê°„ |
|-----|-----------|------|----------|
| `init` | ì´ˆê¸°í™” | ìš”ì²­ ì¤€ë¹„ ì¤‘ | ì¦‰ì‹œ |
| `ad_copy_generation` | ê´‘ê³ ë¬¸êµ¬ ìƒì„± | AIê°€ ê´‘ê³ ë¬¸êµ¬ 5ê°œ ìƒì„± | 10-20ì´ˆ |
| `ad_copy_selection` | ê´‘ê³ ë¬¸êµ¬ ì„ íƒ | ì‚¬ìš©ì ì„ íƒ ëŒ€ê¸° | ì‚¬ìš©ì ì…ë ¥ |
| `image_refinement` | ì´ë¯¸ì§€ ì •ì œ | ìƒí’ˆ ì´ë¯¸ì§€ AI ë³´ì • | 30-60ì´ˆ |
| `video_generation` | ì˜ìƒ ìƒì„± | Sora 2 Proë¡œ ì˜ìƒ ìƒì„± | 2-4ë¶„ |
| `completed` | ì™„ë£Œ | ì˜ìƒ ìƒì„± ì™„ë£Œ | - |

---

## 7. API íë¦„ ìƒì„¸

### 7.1 ê´‘ê³ ë¬¸êµ¬ ìƒì„± (generateAdCopies)

```typescript
// 1. ì¸ì¦ í™•ì¸
const { userId } = await auth();

// 2. ad_videos ë ˆì½”ë“œ ìƒì„± (status: 'pending', progress_stage: 'init')
const adVideo = await supabase.from('ad_videos').insert({...});

// 3. adcopy webhook í˜¸ì¶œ
const response = await fetch('https://n8n.sappstudio.kr/webhook/84e18e95-00b9-4963-9a6f-c14225a84d15', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Basic ' + btoa('username:password')
  },
  body: JSON.stringify({
    ad_video_id: adVideo.id,
    product_image_id: imageId,
    product_info_id: productInfoId
  })
});

// 4. ì‘ë‹µì—ì„œ ê´‘ê³ ë¬¸êµ¬ 5ê°œ ì¶”ì¶œ
const { ad_copies } = await response.json();

// 5. ad_copies í…Œì´ë¸”ì— ì €ì¥
await supabase.from('ad_copies').insert(
  ad_copies.map((copy, idx) => ({
    ad_video_id: adVideo.id,
    copy_index: idx + 1,
    copy_text: copy.text
  }))
);

// 6. ad_videos progress_stageë¥¼ 'ad_copy_selection'ìœ¼ë¡œ ì—…ë°ì´íŠ¸
await supabase.from('ad_videos').update({
  progress_stage: 'ad_copy_selection'
}).eq('id', adVideo.id);

return { success: true, adVideoId: adVideo.id, adCopies: ad_copies };
```

### 7.2 ê´‘ê³ ë¬¸êµ¬ ì„ íƒ & ì˜ìƒìƒì„± ì§„í–‰ (selectAdCopyAndGenerate)

```typescript
// 1. ì„ íƒëœ ê´‘ê³ ë¬¸êµ¬ ì €ì¥
await supabase.from('ad_copies').update({ is_selected: true })
  .eq('ad_video_id', adVideoId)
  .eq('copy_index', selectedIndex);

// 2. ad_videosì— selected_ad_copy ì €ì¥
await supabase.from('ad_videos').update({
  selected_ad_copy: selectedCopyText,
  progress_stage: 'image_refinement'
}).eq('id', adVideoId);

// 3. í¬ë ˆë”§ ì°¨ê° (ì´ ì‹œì ì— ì°¨ê°)
await deductCredits(userId, VIDEO_GENERATION_COST);

// 4. advideo webhook í˜¸ì¶œ
await fetch('https://n8n.sappstudio.kr/webhook/70980457-f61e-42f1-84c3-5245f1438435', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Basic ' + btoa('username:password')
  },
  body: JSON.stringify({
    ad_video_id: adVideoId,
    product_image_id: imageId,
    product_info_id: productInfoId,
    selected_ad_copy: selectedCopyText  // í•µì‹¬: ì„ íƒëœ ê´‘ê³ ë¬¸êµ¬ ì „ì†¡
  })
});

return { success: true };
```

---

## 8. í¬ë ˆë”§ ì°¨ê° ì‹œì  ë³€ê²½

### 8.1 í˜„ì¬ (AS-IS)
- ì˜ìƒ ìƒì„± ì‹œì‘ ì‹œ ì¦‰ì‹œ í¬ë ˆë”§ ì°¨ê°

### 8.2 ë³€ê²½ (TO-BE)
- **ê´‘ê³ ë¬¸êµ¬ ìƒì„±**: í¬ë ˆë”§ ì°¨ê° ì—†ìŒ (ë¬´ë£Œ)
- **ê´‘ê³ ë¬¸êµ¬ ì„ íƒ & ì˜ìƒìƒì„± ì§„í–‰ ì‹œ**: 80 í¬ë ˆë”§ ì°¨ê°

ì´ìœ : ì‚¬ìš©ìê°€ ê´‘ê³ ë¬¸êµ¬ë¥¼ ë³´ê³  ë§ˆìŒì— ë“¤ì§€ ì•Šìœ¼ë©´ "ë‹¤ì‹œ ìƒì„±"ì„ í•  ìˆ˜ ìˆì–´ì•¼ í•˜ë¯€ë¡œ, ìµœì¢… ì˜ìƒ ìƒì„± ì§„í–‰ ì‹œì—ë§Œ í¬ë ˆë”§ì„ ì°¨ê°í•©ë‹ˆë‹¤.

---

## 9. í™˜ê²½ë³€ìˆ˜ ì¶”ê°€

```bash
# .env
N8N_ADCOPY_WEBHOOK_URL=https://n8n.sappstudio.kr/webhook/84e18e95-00b9-4963-9a6f-c14225a84d15
N8N_ADVIDEO_WEBHOOK_URL=https://n8n.sappstudio.kr/webhook/70980457-f61e-42f1-84c3-5245f1438435
N8N_WEBHOOK_USERNAME=ssap_username
N8N_WEBHOOK_PASSWORD=ssap_password
```

---

## 10. êµ¬í˜„ ìˆœì„œ

### Phase 1: ë°ì´í„°ë² ì´ìŠ¤
1. `ad_copies` í…Œì´ë¸” ìƒì„± ë§ˆì´ê·¸ë ˆì´ì…˜
2. `ad_videos` í…Œì´ë¸” ìˆ˜ì • ë§ˆì´ê·¸ë ˆì´ì…˜ (progress_stage, selected_ad_copy)

### Phase 2: íƒ€ì… ë° ìƒìˆ˜
1. `types/ad-copy.ts` ìƒì„±
2. `types/generation.ts` ìˆ˜ì •
3. `constants/generation.ts` ìˆ˜ì •

### Phase 3: Server Actions
1. `actions/generate-ad-copies.ts` ìƒì„±
2. `actions/select-ad-copy.ts` ìƒì„±
3. `actions/fetch-ad-copies.ts` ìƒì„±
4. `actions/trigger-n8n.ts` ìˆ˜ì • (selected_ad_copy íŒŒë¼ë¯¸í„° ì¶”ê°€)

### Phase 4: UI ì»´í¬ë„ŒíŠ¸
1. `components/upload/ad-copy-card.tsx` ìƒì„±
2. `components/upload/ad-copy-selection.tsx` ìƒì„±
3. `components/upload/ad-copy-skeleton.tsx` ìƒì„±
4. `components/upload/upload-form.tsx` ìˆ˜ì • (4ë‹¨ê³„ ì›Œí¬í”Œë¡œìš°)

### Phase 5: ì§„í–‰ ìƒíƒœ UI
1. `components/generation/step-indicator.tsx` ìˆ˜ì • (6ë‹¨ê³„)
2. `lib/generation-utils.ts` ìˆ˜ì •

### Phase 6: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦
1. ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸
2. ì—ëŸ¬ í•¸ë“¤ë§ ê²€ì¦
3. í¬ë ˆë”§ ì°¨ê° ë¡œì§ ê²€ì¦

---

## 11. ì¶”ê°€ ê°œì„  ì œì•ˆ (ì„ íƒì‚¬í•­)

### 11.1 ê´‘ê³ ë¬¸êµ¬ ì¹´ë“œì— í‘œì‹œí•˜ë©´ ì¢‹ì„ ì •ë³´

1. **ìŠ¤íƒ€ì¼ íƒœê·¸**
   - ê° ë¬¸êµ¬ì˜ íŠ¹ì„± í‘œì‹œ (ë¼ì„, ê³µê°, ë©”íƒ€, ê³¼ì¥, ì•„ë¬´ë§)
   - ì‚¬ìš©ìê°€ ì›í•˜ëŠ” ìŠ¤íƒ€ì¼ ì„ íƒì— ë„ì›€

2. **ë¬¸êµ¬ ê¸¸ì´ í‘œì‹œ**
   - ê¸€ììˆ˜ í‘œì‹œ
   - 12ì´ˆ ì˜ìƒì— ì í•©í•œì§€ ì‹œê°ì  í‘œì‹œ

3. **ë¯¸ë¦¬ë³´ê¸° ì•„ì´ì½˜**
   - ë¬¸êµ¬ ìŠ¤íƒ€ì¼ì— ë§ëŠ” ì´ëª¨ì§€ ë˜ëŠ” ì•„ì´ì½˜

### 11.2 UX ê°œì„ 

1. **í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤**
   - ìˆ«ìí‚¤ 1-5ë¡œ ë¬¸êµ¬ ì„ íƒ
   - Enterë¡œ ì„ íƒ í™•ì •

2. **ì• ë‹ˆë©”ì´ì…˜**
   - ì¹´ë“œ ìƒì„± ì‹œ ìˆœì°¨ì  fade-in
   - ì„ íƒ ì‹œ pulse íš¨ê³¼

3. **ì ‘ê·¼ì„±**
   - ìŠ¤í¬ë¦° ë¦¬ë” ì§€ì›
   - ì¶©ë¶„í•œ ìƒ‰ìƒ ëŒ€ë¹„

---

## 12. ë¦¬ìŠ¤í¬ ë° ëŒ€ì‘

| ë¦¬ìŠ¤í¬ | ì˜í–¥ë„ | ëŒ€ì‘ ë°©ì•ˆ |
|--------|-------|----------|
| adcopy webhook ì‘ë‹µ ì§€ì—° | ì¤‘ | íƒ€ì„ì•„ì›ƒ ì„¤ì • (30ì´ˆ), ë¡œë”© ìƒíƒœ í‘œì‹œ |
| ê´‘ê³ ë¬¸êµ¬ ìƒì„± ì‹¤íŒ¨ | ì¤‘ | ì¬ì‹œë„ ë²„íŠ¼, ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ |
| ì‚¬ìš©ìê°€ ë¬¸êµ¬ ì„ íƒ ì•ˆí•˜ê³  ì´íƒˆ | ë‚® | ad_copy_selection ìƒíƒœë¡œ ë³´ì¡´, ì¬ì ‘ì† ì‹œ ì´ì–´ì„œ ì§„í–‰ ê°€ëŠ¥ |
| advideo webhook í˜¸ì¶œ ì‹¤íŒ¨ | ë†’ | ì¬ì‹œë„ ë¡œì§, í¬ë ˆë”§ í™˜ë¶ˆ ì²˜ë¦¬ |

---

## 13. ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© (`ad_copies` í…Œì´ë¸”)
- [ ] Supabase ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© (`ad_videos` ìˆ˜ì •)
- [ ] íƒ€ì… ì •ì˜ íŒŒì¼ ìƒì„±
- [ ] ìƒìˆ˜ íŒŒì¼ ìˆ˜ì •
- [ ] generateAdCopies ì•¡ì…˜ êµ¬í˜„
- [ ] selectAdCopy ì•¡ì…˜ êµ¬í˜„
- [ ] fetchAdCopies ì•¡ì…˜ êµ¬í˜„
- [ ] trigger-n8n ì•¡ì…˜ ìˆ˜ì •
- [ ] AdCopyCard ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- [ ] AdCopySelection ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- [ ] UploadForm 4ë‹¨ê³„ë¡œ ìˆ˜ì •
- [ ] StepIndicator 6ë‹¨ê³„ë¡œ ìˆ˜ì •
- [ ] ì§„í–‰ë¥  ê³„ì‚° ë¡œì§ ìˆ˜ì •
- [ ] í™˜ê²½ë³€ìˆ˜ ì„¤ì •
- [ ] ì „ì²´ í”Œë¡œìš° í…ŒìŠ¤íŠ¸

---

_ì‘ì„±ì™„ë£Œ: 2025-11-29_
